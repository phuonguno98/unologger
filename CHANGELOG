# Changelog

Táº¥t cáº£ thay Ä‘á»•i quan trá»ng cá»§a dá»± Ã¡n nÃ y sáº½ Ä‘Æ°á»£c ghi láº¡i trong file nÃ y.

## [1.1.0] - 2025-09-15
### ğŸš€ NÃ¢ng cáº¥p & tÃ­nh nÄƒng
- Atomic batch config: thÃªm `batchSizeA`, `batchWaitA` Ä‘á»ƒ cáº­p nháº­t batch-size/max-wait theo thá»i gian thá»±c qua `SetBatchConfig` (khÃ´ng cáº§n khá»Ÿi Ä‘á»™ng láº¡i worker).
- JSON mode an toÃ n: thÃªm `jsonFmtFlag` (atomic) vÃ  cáº­p nháº­t `SetJSONFormat` dÃ¹ng cá» atomic.
- Hook runner cÃ³ thá»ƒ khá»Ÿi Ä‘á»™ng láº¡i sau khi Ä‘Ã³ng: `closeHookRunner` Ä‘áº·t `hookQueueCh = nil` Ä‘á»ƒ cho phÃ©p `SetHooks` báº­t láº¡i khi runtime.
- Báº£o vá»‡ global logger: truy cáº­p `globalLogger` Ä‘á»“ng bá»™ báº±ng `globalMu (RWMutex)`; `ensureInit` dÃ¹ng `sync.Once` + kiá»ƒm tra an toÃ n.
- Snapshot outputs khi ghi: `writeToAll` chá»¥p `stdout/stderr/rotation/extras` dÆ°á»›i khÃ³a Ä‘á»c rá»“i ghi ngoÃ i khÃ³a, giáº£m Ä‘á»™ tranh cháº¥p.
- API khÃ´ng thay Ä‘á»•i; tÆ°Æ¡ng thÃ­ch ngÆ°á»£c vá»›i 1.0.0.

### ğŸ› Sá»­a lá»—i
- TrÃ¡nh double-close: `atomicBool.TrySetTrue()` báº£o vá»‡ `closeLogger` khá»i Ä‘Ã³ng channel nhiá»u láº§n.
- DropOldest thu há»“i log bá»‹ drop: khi hÃ ng Ä‘á»£i Ä‘áº§y vÃ  `DropOldest=true`, entry bá»‹ loáº¡i bá» sáº½ Ä‘Æ°á»£c tráº£ vá» pool vÃ  tÄƒng `droppedCount`.
- Äá»c retry policy an toÃ n: `safeWrite` snapshot `retryPolicy` dÆ°á»›i khÃ³a, Ä‘á»“ng thá»i clamp `MaxRetries>=0`, `Backoff>=0`.
- Kháº¯c phá»¥c race tiá»m áº©n:
  - Äá»c `globalLogger` trong `GetLogger/Stats/Close` dÃ¹ng `globalMu.RLock`.
  - Äá»•i timezone an toÃ n vá»›i `locMu`.
  - Báº­t/táº¯t OTel/JSON mode dÃ¹ng atomic flags.

### âš¡ Hiá»‡u nÄƒng & an toÃ n cáº¡nh tranh
- Giáº£m lock contention khi I/O báº±ng snapshot outputs.
- Worker tá»± Ä‘á»™ng Ä‘á»c cáº¥u hÃ¬nh batch má»›i (atomic), timer reset theo giÃ¡ trá»‹ má»›i.
- Idempotent close: an toÃ n khi gá»i `Close/CloseDetached` nhiá»u láº§n hoáº·c song song.

### ğŸ“š TÃ i liá»‡u & vÃ­ dá»¥
- Viáº¿t láº¡i GoDoc, chuáº©n hÃ³a comment cho toÃ n bá»™ API export.
- Cáº­p nháº­t README vá»›i hÆ°á»›ng dáº«n Quick Start, Ä‘á»™ng cáº¥u hÃ¬nh, hooks, masking, rotation, OTel, Stats/Close.
- VÃ­ dá»¥ Ä‘áº§y Ä‘á»§ táº¡i `example/main.go`, bao phá»§ háº§u háº¿t API (khÃ´ng gá»i Fatal trá»« khi báº­t `DEMO_FATAL=1`).

### ğŸ§© KhÃ¡c
- KhÃ´ng cÃ³ thay Ä‘á»•i phÃ¡ vá»¡ (breaking changes).
- YÃªu cáº§u Go tá»‘i thiá»ƒu váº«n lÃ  1.25.

## [1.0.0] - 2025-09-14
### ğŸ‰ Ra máº¯t phiÃªn báº£n Ä‘áº§u tiÃªn (Stable Release)

#### âœ¨ TÃ­nh nÄƒng má»›i
- **Há»‡ thá»‘ng log báº¥t Ä‘á»“ng bá»™** vá»›i channel buffer vÃ  worker xá»­ lÃ½ song song.
- **Há»— trá»£ nhiá»u cáº¥p Ä‘á»™ log**: `DEBUG`, `INFO`, `WARN`, `ERROR`, `FATAL`.
- **Context-first API**:
  - Gáº¯n metadata (`module`, `trace_id`, `flow_id`, `attrs`) vÃ o `context.Context`.
  - Láº¥y logger tá»« context qua `GetLogger`.
- **Masking dá»¯ liá»‡u nháº¡y cáº£m**:
  - Mask báº±ng regex (`RegexRules` / `RegexPatternMap`).
  - Mask theo field JSON (`JSONFieldRules`).
- **Batch processing**: gom nhiá»u log entry thÃ nh batch Ä‘á»ƒ giáº£m I/O.
- **Hook**: chÃ¨n hÃ m xá»­ lÃ½ tÃ¹y chá»‰nh trÆ°á»›c/sau khi ghi log.
- **Rotation**: xoay file log theo dung lÆ°á»£ng hoáº·c thá»i gian.
- **Dynamic config**: thay Ä‘á»•i cáº¥u hÃ¬nh logger khi runtime (min level, masking rules, retry policy, hooks, batch config).
- **OpenTelemetry integration**: tá»± Ä‘á»™ng láº¥y `trace_id` tá»« OTel context náº¿u báº­t `EnableOTEL`.
- **Adapter**:
  - `SimpleLogger` interface (4 cáº¥p Ä‘á»™ cÆ¡ báº£n).
  - `ExtendedLogger` interface (thÃªm `Fatal`).
  - `Adapter` bá»c `LoggerWithCtx` Ä‘á»ƒ triá»ƒn khai cÃ¡c interface nÃ y.
- **API khá»Ÿi táº¡o**:
  - `InitLogger` (cáº¥u hÃ¬nh nhanh).
  - `InitLoggerWithConfig` (cáº¥u hÃ¬nh Ä‘áº§y Ä‘á»§).
  - `NewDetachedLogger` (logger tÃ¡ch biá»‡t).
- **ÄÃ³ng logger an toÃ n**:
  - `Close(timeout)` flush toÃ n bá»™ log, dá»«ng worker, Ä‘Ã³ng writer.
  - In thá»‘ng kÃª lá»—i writer khi shutdown.

#### ğŸ›  Cáº£i tiáº¿n
- TÃ­ch há»£p `compileMaskRegexes` vÃ o luá»“ng khá»Ÿi táº¡o Ä‘á»ƒ tá»± Ä‘á»™ng compile regex tá»« `RegexPatternMap`.
- Gá»i `formatWriterErrorStats` khi Ä‘Ã³ng logger Ä‘á»ƒ hiá»ƒn thá»‹ thá»‘ng kÃª lá»—i writer.
- Bá»• sung kiá»ƒm tra nil writer trong `safeWrite` Ä‘á»ƒ trÃ¡nh panic.
- Tá»± Ä‘á»™ng gÃ¡n `os.Stdout`/`os.Stderr` náº¿u writer chÃ­nh chÆ°a Ä‘Æ°á»£c set.

#### ğŸ“š TÃ i liá»‡u
- Viáº¿t láº¡i `doc.go` vá»›i vÃ­ dá»¥ nÃ¢ng cao bao quÃ¡t toÃ n bá»™ tÃ­nh nÄƒng.
- ThÃªm README.md chi tiáº¿t vá»›i hÆ°á»›ng dáº«n cÃ i Ä‘áº·t, sá»­ dá»¥ng cÆ¡ báº£n vÃ  nÃ¢ng cao.
- Bá»• sung vÃ­ dá»¥ sá»­ dá»¥ng logger qua context trong cÃ¡c hÃ m bÃªn ngoÃ i.

---

[1.1.0]: https://github.com/phuonguno98/unologger/releases/tag/v1.1.0
[1.0.0]: https://github.com/phuonguno98/unologger/releases/tag/v1.0.0